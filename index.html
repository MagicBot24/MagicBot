<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Magic Robot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    };
  </script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold text-cyan-400 mb-6">Magic Robot</h1>

  <div class="w-full max-w-2xl bg-gray-800 rounded-xl shadow-lg p-6 flex flex-col space-y-4">
    <div id="chat" class="h-96 overflow-y-auto space-y-3 bg-gray-700 p-4 rounded-lg border border-gray-600"></div>
    <div class="flex gap-2">
      <input id="input" type="text" placeholder="আপনার প্রশ্ন লিখুন..." class="flex-grow bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white" />
      <button id="sendBtn" class="bg-cyan-600 text-white px-6 py-2 rounded-lg hover:bg-cyan-700 transition">Send</button>
    </div>
  </div>

<script>
  const API_KEY = "AIzaSyCb2Q72UY_t3HB9eOuWo0L5jo5K-LmKCJc";
  const CSE_ID = "b7013f3574abc40c3";

  const chat = document.getElementById('chat');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');

  const memory = {
    owner: "Rashed Khan",
    name: "Magic Robot",
    conversationHistory: [],
    brainData: {}
  };

  // লোকালস্টোরেজ থেকে মেমরি লোড
  function loadMemory() {
    const storedBrain = localStorage.getItem('magicRobotBrain');
    if (storedBrain) {
      try {
        memory.brainData = JSON.parse(storedBrain);
      } catch {
        memory.brainData = {};
      }
    }
  }

  // লোকালস্টোরেজে মেমরি সেভ
  function saveMemory() {
    localStorage.setItem('magicRobotBrain', JSON.stringify(memory.brainData));
  }

  function renderMessage(sender, text) {
    const div = document.createElement('div');
    div.classList.add('max-w-[80%]', 'px-4', 'py-2', 'rounded-lg', 'text-sm', 'whitespace-pre-wrap');
    if (sender === 'user') {
      div.classList.add('bg-cyan-600', 'text-white', 'ml-auto');
      div.textContent = `🧑: ${text}`;
    } else {
      div.classList.add('bg-gray-600', 'text-white', 'mr-auto');
      div.textContent = `🤖: ${text}`;
    }
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    return div;
  }

  function ownBrainResponse(text) {
    const lower = text.toLowerCase().trim();

    // Greeting responses
    const greetings = ["hi", "hello", "হাই", "হ্যালো", "hola", "hey", "nomoskar", "সালাম"];
    if (greetings.includes(lower)) {
      return "হ্যালো! কেমন আছো? আমি তোমার Magic Robot — সাহায্য করতে প্রস্তুত! 🤖";
    }

    if (lower.includes("তোমার নাম") || lower.includes("what is your name")) {
      return `আমার নাম ${memory.name} — তবে বন্ধুদের জন্য শুধু "Magic" বললেই চলবে। 😉`;
    }
    if (lower.includes("তুমি কে") || lower.includes("who are you")) {
      return `আমি ${memory.name}, তৈরি করেছে ${memory.owner}। আমি প্রশ্নের উত্তর দেই, আর মাঝে মাঝে ভাবিও করি!`;
    }
    if (lower.includes("তোমার মালিক কে") || lower.includes("who is your owner")) {
      return `আমার প্রোগ্রামার এবং মালিক ${memory.owner}। সে-ই আমাকে তৈরি করেছে!`;
    }
    if (lower.includes("কেমন আছো") || lower.includes("how are you")) {
      return "আমি তো দারুণ আছি! তুমি কেমন আছো?";
    }
    if (lower.includes("ধন্যবাদ") || lower.includes("thanks")) {
      return "আরে না না, তোমাকেই ধন্যবাদ বলার কথা! 😊";
    }
    if (lower.includes("মনে রেখো") || lower.includes("remember")) {
      return "ঠিক আছে, মনে রাখছি — কিন্তু রিফ্রেশ করলে ভুলে যাবো!";
    }

    if (memory.brainData[lower]) {
      return memory.brainData[lower];
    }

    return null;
  }

  async function fetchFromGoogle(query) {
    const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CSE_ID}&q=${encodeURIComponent(query)}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.items && data.items.length > 0) {
        return data.items[0].snippet;
      } else {
        return "দুঃখিত, গুগল থেকে কিছুই খুঁজে পাইনি। 😓";
      }
    } catch (err) {
      console.error(err);
      return "ওহ না! গুগল কিছুক্ষণ ধরে চুপ করে আছে। 😶";
    }
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    renderMessage('user', text);
    memory.conversationHistory.push(text);
    input.value = '';

    const lowerText = text.toLowerCase().trim();
    let reply = ownBrainResponse(text);

    if (reply !== null) {
      renderMessage('bot', reply);
    } else {
      const loading = renderMessage('bot', "🤖: একটু গুগলে খুঁজে দেখি...");
      const googleReply = await fetchFromGoogle(text);

      // Save to memory and localStorage
      memory.brainData[lowerText] = googleReply;
      saveMemory();

      loading.textContent = `🤖: ${googleReply}`;
    }
  }

  // পেজ লোড হলে মেমরি লোড করবে
  window.onload = loadMemory;

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendMessage();
  });
</script>

</body>
</html>
