<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Magic Robot with Google Search</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    };
  </script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold text-cyan-400 mb-6">Magic Robot with Google Search</h1>

  <div class="w-full max-w-2xl bg-gray-800 rounded-xl shadow-lg p-6 flex flex-col space-y-4">
    <div id="chat" class="h-96 overflow-y-auto space-y-3 bg-gray-700 p-4 rounded-lg border border-gray-600"></div>

    <div class="flex gap-2">
      <input id="input" type="text" placeholder="à¦†à¦ªà¦¨à¦¾à¦° à¦ªà§à¦°à¦¶à§à¦¨ à¦²à¦¿à¦–à§à¦¨..." class="flex-grow bg-gray-900 border border-gray-600 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-cyan-500 text-white" />
      <button id="sendBtn" class="bg-cyan-600 text-white px-6 py-2 rounded-lg hover:bg-cyan-700 transition">Send</button>
    </div>

    <!-- Google Custom Search official embed -->
    <div class="mt-6">
      <script async src="https://cse.google.com/cse.js?cx=b7013f3574abc40c3"></script>
      <div class="gcse-search"></div>
    </div>
  </div>

<script>
  const API_KEY = "AIzaSyCb2Q72UY_t3HB9eOuWo0L5jo5K-LmKCJc";
  const CSE_ID = "b7013f3574abc40c3";

  const chat = document.getElementById('chat');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');

  // Magic Robot memory & conversation storage
  const memory = {
    owner: "Rashed Khan",
    name: "Magic Robot",
    brainData: {},
    conversationHistory: []
  };

  // Load memory from localStorage
  function loadMemory() {
    const stored = localStorage.getItem('magicRobotBrain');
    if (stored) {
      try {
        memory.brainData = JSON.parse(stored);
      } catch {
        memory.brainData = {};
      }
    }
  }

  // Save memory to localStorage
  function saveMemory() {
    localStorage.setItem('magicRobotBrain', JSON.stringify(memory.brainData));
  }

  // Render a chat message on UI
  function renderMessage(sender, text) {
    const div = document.createElement('div');
    div.classList.add('max-w-[80%]', 'px-4', 'py-2', 'rounded-lg', 'text-sm', 'whitespace-pre-wrap');
    if (sender === 'user') {
      div.classList.add('bg-cyan-600', 'text-white', 'ml-auto');
      div.textContent = `ðŸ§‘: ${text}`;
    } else {
      div.classList.add('bg-gray-600', 'text-white', 'mr-auto');
      div.textContent = `ðŸ¤–: ${text}`;
    }
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  // Own brain with fixed Q&A + memory recall
  function ownBrainResponse(text) {
    const lower = text.toLowerCase().trim();

    const greetings = ["hi", "hello", "à¦¹à¦¾à¦‡", "à¦¹à§à¦¯à¦¾à¦²à§‹", "hola", "hey", "nomoskar", "à¦¸à¦¾à¦²à¦¾à¦®"];
    if (greetings.includes(lower)) {
      return "à¦¹à§à¦¯à¦¾à¦²à§‹! à¦•à§‡à¦®à¦¨ à¦†à¦›à§‹? à¦†à¦®à¦¿ à¦¤à§‹à¦®à¦¾à¦° Magic Robot â€” à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯ à¦•à¦°à¦¤à§‡ à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤! ðŸ¤–";
    }
    if (lower.includes("à¦¤à§à¦®à¦¿ à¦•à¦¿ à¦ªà¦¾à¦°à§‹") || lower.includes("what can you do")) {
      return "à¦†à¦®à¦¿ à¦¤à§‹à¦®à¦¾à¦° Magic Robot! à¦†à¦®à¦¿ à¦¤à§‹à¦®à¦¾à¦° à¦ªà§à¦°à¦¶à§à¦¨à§‡à¦° à¦‰à¦¤à§à¦¤à¦° à¦¦à§‡à¦¬, à¦—à§à¦—à¦²à§‡ à¦–à§à¦à¦œà§‡ à¦†à¦¨à¦¬à§‹, à¦†à¦° à¦¶à§‡à¦–à¦¾à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à¦¬à¥¤ à¦¤à§à¦®à¦¿ à¦¯à¦¾ à¦šà¦¾à¦“, à¦¬à¦²à§‹! ðŸ¤–âœ¨";
    }
    if (lower.includes("à¦¤à§‹à¦®à¦¾à¦° à¦¨à¦¾à¦®") || lower.includes("what is your name")) {
      return `à¦†à¦®à¦¾à¦° à¦¨à¦¾à¦® ${memory.name} â€” à¦¤à¦¬à§‡ à¦¬à¦¨à§à¦§à§à¦¦à§‡à¦° à¦œà¦¨à§à¦¯ à¦¶à§à¦§à§ "Magic" à¦¬à¦²à¦²à§‡à¦‡ à¦šà¦²à¦¬à§‡à¥¤ ðŸ˜‰`;
    }
    if (lower.includes("à¦¤à§à¦®à¦¿ à¦•à§‡") || lower.includes("who are you")) {
      return `à¦†à¦®à¦¿ ${memory.name}, à¦¤à§ˆà¦°à¦¿ à¦•à¦°à§‡à¦›à§‡ ${memory.owner}à¥¤ à¦†à¦®à¦¿ à¦ªà§à¦°à¦¶à§à¦¨à§‡à¦° à¦‰à¦¤à§à¦¤à¦° à¦¦à§‡à¦‡, à¦†à¦° à¦®à¦¾à¦à§‡ à¦®à¦¾à¦à§‡ à¦­à¦¾à¦¬à¦¿à¦“ à¦•à¦°à¦¿!`;
    }
    if (lower.includes("à¦¤à§‹à¦®à¦¾à¦° à¦®à¦¾à¦²à¦¿à¦• à¦•à§‡") || lower.includes("who is your owner")) {
      return `à¦†à¦®à¦¾à¦° à¦ªà§à¦°à§‹à¦—à§à¦°à¦¾à¦®à¦¾à¦° à¦à¦¬à¦‚ à¦®à¦¾à¦²à¦¿à¦• ${memory.owner}à¥¤ à¦¸à§‡-à¦‡ à¦†à¦®à¦¾à¦•à§‡ à¦¤à§ˆà¦°à¦¿ à¦•à¦°à§‡à¦›à§‡!`;
    }
    if (lower.includes("à¦•à§‡à¦®à¦¨ à¦†à¦›à§‹") || lower.includes("how are you")) {
      return "à¦†à¦®à¦¿ à¦¤à§‹ à¦¦à¦¾à¦°à§à¦£ à¦†à¦›à¦¿! à¦¤à§à¦®à¦¿ à¦•à§‡à¦®à¦¨ à¦†à¦›à§‹?";
    }
    if (lower.includes("à¦§à¦¨à§à¦¯à¦¬à¦¾à¦¦") || lower.includes("thanks")) {
      return "à¦†à¦°à§‡ à¦¨à¦¾ à¦¨à¦¾, à¦¤à§‹à¦®à¦¾à¦•à§‡à¦‡ à¦§à¦¨à§à¦¯à¦¬à¦¾à¦¦ à¦¬à¦²à¦¾à¦° à¦•à¦¥à¦¾! ðŸ˜Š";
    }
    if (lower.includes("à¦®à¦¨à§‡ à¦°à§‡à¦–à§‹") || lower.includes("remember")) {
      const rememberText = text.split(/à¦®à¦¨à§‡ à¦°à§‡à¦–à§‹|remember/i)[1]?.trim();
      if (rememberText) {
        // Add to brain data (key-value)
        const [key, ...valueParts] = rememberText.split("=");
        if (key && valueParts.length > 0) {
          const val = valueParts.join("=").trim();
          memory.brainData[key.toLowerCase().trim()] = val;
          saveMemory();
          return `à¦ à¦¿à¦• à¦†à¦›à§‡, à¦†à¦®à¦¿ à¦®à¦¨à§‡ à¦°à§‡à¦–à§‡à¦›à¦¿ "${key.trim()}" à¦à¦° à¦®à¦¾à¦¨ "${val}"à¥¤`;
        }
        return "à¦®à¦¨à§‡ à¦°à¦¾à¦–à¦¤à§‡ à¦¹à¦²à§‡ 'à¦®à¦¨à§‡ à¦°à§‡à¦–à§‹ key = value' à¦à¦‡ à¦«à¦°à¦®à§à¦¯à¦¾à¦Ÿà§‡ à¦¬à¦²à§‹à¥¤ à¦‰à¦¦à¦¾à¦¹à¦°à¦£: à¦®à¦¨à§‡ à¦°à§‡à¦–à§‹ à¦¤à§‹à¦®à¦¾à¦° à¦°à¦™ = à¦¨à§€à¦²";
      }
      return "à¦•à¦¿ à¦®à¦¨à§‡ à¦°à¦¾à¦–à¦¤à§‡ à¦¹à¦¬à§‡ à¦¬à¦²à§‹ à¦¤à§‹!";
    }

    // Check memory for stored answers
    if (memory.brainData[lower]) {
      return memory.brainData[lower];
    }

    return null;
  }

  // Google Custom Search API call (fetch)
  async function fetchFromGoogleAPI(query) {
    const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CSE_ID}&q=${encodeURIComponent(query)}`;
    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error("Google API Error");
      const data = await res.json();
      if (data.items && data.items.length > 0) {
        // Return first 3 result snippets concatenated
        return data.items.slice(0, 3).map(item => `â€¢ ${item.title}: ${item.snippet}`).join("\n\n");
      } else {
        return "à¦•à¦¿à¦›à§ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿà¦¨à¦¿ Google à¦¸à¦¾à¦°à§à¦šà§‡à¥¤";
      }
    } catch (err) {
      return "Google à¦¸à¦¾à¦°à§à¦šà§‡ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¹à§Ÿà§‡à¦›à§‡, à¦ªà¦°à§‡ à¦†à¦¬à¦¾à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à§‹à¥¤";
    }
  }

  // Handle user input & respond
  async function handleUserMessage(text) {
    renderMessage('user', text);

    // Try own brain first
    let reply = ownBrainResponse(text);
    if (reply) {
      renderMessage('bot', reply);
      return;
    }

    // Otherwise try Google API search
    renderMessage('bot', "à¦†à¦®à¦¿ à¦—à§à¦—à¦²à§‡ à¦–à§à¦à¦œà¦›à¦¿... à¦à¦•à¦Ÿà§ à¦¸à¦®à§Ÿ à¦¦à¦¾à¦“à¥¤");
    const googleReply = await fetchFromGoogleAPI(text);
    renderMessage('bot', googleReply);
  }

  // Init
  loadMemory();

  sendBtn.addEventListener('click', () => {
    const text = input.value.trim();
    if (!text) return;
    handleUserMessage(text);
    input.value = '';
  });

  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      sendBtn.click();
    }
  });
</script>

</body>
</html>
