<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Magic Robot - Smart & Google Powered Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

  <h1 class="text-3xl font-bold text-blue-700 mb-6">ðŸ¤– Magic Robot (by Rashed Khan)</h1>

  <div class="w-full max-w-2xl bg-white rounded-xl shadow-lg p-6 flex flex-col space-y-4">
    <div id="chat" class="h-96 overflow-y-auto space-y-3 bg-gray-50 p-4 rounded-lg border border-gray-200">
      <!-- Chat messages will appear here -->
    </div>

    <div class="flex gap-2">
      <input id="input" type="text" placeholder="à¦†à¦ªà¦¨à¦¾à¦° à¦ªà§à¦°à¦¶à§à¦¨ à¦²à¦¿à¦–à§à¦¨..." class="flex-grow border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400" />
      <button id="sendBtn" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">Send</button>
    </div>
  </div>

<script>
  const API_KEY = "AIzaSyCb2Q72UY_t3HB9eOuWo0L5jo5K-LmKCJc";
  const CSE_ID = "b7013f3574abc40c3";

  const chat = document.getElementById('chat');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');

  // Bot memory for the session (reset on reload)
  let memory = {
    owner: "Rashed Khan",
    name: "Magic Robot",
    conversationHistory: []
  };

  function renderMessage(sender, text) {
    const div = document.createElement('div');
    div.classList.add('max-w-[80%]', 'px-4', 'py-2', 'rounded-lg', 'text-sm', 'whitespace-pre-wrap');
    if (sender === 'user') {
      div.classList.add('bg-blue-500', 'text-white', 'ml-auto');
      div.textContent = `ðŸ§‘: ${text}`;
    } else {
      div.classList.add('bg-gray-200', 'text-gray-900', 'mr-auto');
      div.textContent = `ðŸ¤–: ${text}`;
    }
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  // Simple NLP-like own brain responses
  function ownBrainResponse(text) {
    const lower = text.toLowerCase();

    if (lower.includes("à¦¤à§‹à¦®à¦¾à¦° à¦¨à¦¾à¦®") || lower.includes("what is your name")) {
      return `à¦†à¦®à¦¾à¦° à¦¨à¦¾à¦® ${memory.name}à¥¤`;
    }
    if (lower.includes("à¦¤à§à¦®à¦¿ à¦•à§‡") || lower.includes("who are you")) {
      return `à¦†à¦®à¦¿ ${memory.name}, à¦†à¦®à¦¾à¦° à¦®à¦¾à¦²à¦¿à¦• ${memory.owner}à¥¤ à¦†à¦®à¦¿ à¦¤à§‹à¦®à¦¾à¦° à¦¸à¦¾à¦¹à¦¾à¦¯à§à¦¯à§‡ à¦†à¦›à¦¿à¥¤`;
    }
    if (lower.includes("à¦¤à§‹à¦®à¦¾à¦° à¦®à¦¾à¦²à¦¿à¦• à¦•à§‡") || lower.includes("who is your owner")) {
      return `à¦†à¦®à¦¾à¦° à¦®à¦¾à¦²à¦¿à¦• ${memory.owner}à¥¤`;
    }
    if (lower.includes("à¦•à§‡à¦®à¦¨ à¦†à¦›à§‹") || lower.includes("how are you")) {
      return "à¦†à¦®à¦¿ à¦­à¦¾à¦²à§‹ à¦†à¦›à¦¿, à¦¤à§‹à¦®à¦¾à¦° à¦•à¦¥à¦¾ à¦¶à§à¦¨à¦¤à§‡ à¦ªà§‡à¦°à§‡ à¦­à¦¾à¦²à§‹ à¦²à¦¾à¦—à¦›à§‡!";
    }
    if (lower.includes("à¦§à¦¨à§à¦¯à¦¬à¦¾à¦¦") || lower.includes("thanks")) {
      return "à¦¤à§‹à¦®à¦¾à¦•à§‡ à¦§à¦¨à§à¦¯à¦¬à¦¾à¦¦! à¦†à¦°à¦“ à¦•à¦¿à¦›à§ à¦œà¦¾à¦¨à¦¤à§‡ à¦šà¦¾à¦“?";
    }
    if (lower.includes("à¦®à¦¨à§‡ à¦°à§‡à¦–à§‹") || lower.includes("remember")) {
      return "à¦†à¦®à¦¿ à¦¤à§‹à¦®à¦¾à¦° à¦•à¦¥à¦¾ à¦®à¦¨à§‡ à¦°à¦¾à¦–à¦¬à¥¤";
    }
    if (lower.includes("à¦¤à§à¦®à¦¿ à¦•à¦¿ à¦†à¦®à¦¾à¦•à§‡ à¦šà¦¿à¦¨à¦¤à§‡ à¦ªà¦¾à¦°à§‹") || lower.includes("do you remember me")) {
      if(memory.conversationHistory.length > 0) {
        return `à¦¹à§à¦¯à¦¾à¦, à¦†à¦®à¦¿ à¦¤à§‹à¦®à¦¾à¦° à¦•à¦¿à¦›à§ à¦•à¦¥à¦¾ à¦®à¦¨à§‡ à¦°à¦¾à¦–à¦¤à§‡ à¦ªà¦¾à¦°à¦¿, à¦¯à§‡à¦®à¦¨: "${memory.conversationHistory.slice(-3).join(", ")}"`;
      } else {
        return "à¦¦à§à¦ƒà¦–à¦¿à¦¤, à¦à¦–à¦¨à§‹ à¦¤à§‹à¦®à¦¾à¦° à¦•à¦¥à¦¾ à¦®à¦¨à§‡ à¦°à¦¾à¦–à¦¿à¦¨à¦¿à¥¤";
      }
    }
    // à¦•à§‹à¦¨à§‹ à¦¸à¦¹à¦œ à¦‰à¦¤à§à¦¤à¦° à¦¨à¦¾ à¦ªà§‡à¦²à§‡ null à¦°à¦¿à¦Ÿà¦¾à¦°à§à¦¨ à¦•à¦°à§‹
    return null;
  }

  // Decide whether to call Google or not
  function shouldUseGoogle(text) {
    const lower = text.toLowerCase();
    const knownKeywords = [
      "à¦¤à§‹à¦®à¦¾à¦° à¦¨à¦¾à¦®", "who are you", "à¦¤à§à¦®à¦¿ à¦•à§‡", "who is your owner",
      "à¦¤à§‹à¦®à¦¾à¦° à¦®à¦¾à¦²à¦¿à¦• à¦•à§‡", "à¦•à§‡à¦®à¦¨ à¦†à¦›à§‹", "how are you", "à¦§à¦¨à§à¦¯à¦¬à¦¾à¦¦", "thanks",
      "à¦®à¦¨à§‡ à¦°à§‡à¦–à§‹", "remember", "à¦¤à§à¦®à¦¿ à¦•à¦¿ à¦†à¦®à¦¾à¦•à§‡ à¦šà¦¿à¦¨à¦¤à§‡ à¦ªà¦¾à¦°à§‹", "do you remember me"
    ];
    for (const kw of knownKeywords) {
      if (lower.includes(kw)) {
        return false; // à¦¨à¦¿à¦œà§‡à¦° à¦‰à¦¤à§à¦¤à¦°à§‡ à¦¦à¦¿à¦¬à§‡
      }
    }
    // à¦¬à¦¾à¦•à¦¿à¦—à§à¦²à§‹à¦¤à§‡ à¦—à§à¦—à¦² à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¬à§‡
    return true;
  }

  // Fetch from Google Custom Search API
  async function fetchFromGoogle(query) {
    const url = `https://www.googleapis.com/customsearch/v1?key=${API_KEY}&cx=${CSE_ID}&q=${encodeURIComponent(query)}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data.items && data.items.length > 0) {
        return data.items[0].snippet;
      } else {
        return "à¦¦à§à¦ƒà¦–à¦¿à¦¤, à¦—à§à¦—à¦² à¦¥à§‡à¦•à§‡ à¦•à§‹à¦¨à§‹ à¦¤à¦¥à§à¦¯ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿà¦¨à¦¿à¥¤";
      }
    } catch (err) {
      console.error(err);
      return "à¦¦à§à¦ƒà¦–à¦¿à¦¤, à¦—à§à¦—à¦² à¦¥à§‡à¦•à§‡ à¦¤à¦¥à§à¦¯ à¦†à¦¨à¦¤à§‡ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¹à§Ÿà§‡à¦›à§‡à¥¤";
    }
  }

  // Handle sending message
  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    renderMessage('user', text);
    input.value = '';

    // Save user message in memory
    memory.conversationHistory.push(text);

    // Try to answer from own brain first
    const ownAnswer = ownBrainResponse(text);
    if (ownAnswer !== null) {
      renderMessage('bot', ownAnswer);
      return;
    }

    // If own brain canâ€™t answer, call google
    if (shouldUseGoogle(text)) {
      renderMessage('bot', "à¦à¦•à¦Ÿà§ à¦—à§à¦—à¦²à§‡ à¦–à§à¦à¦œà§‡ à¦¦à§‡à¦–à¦¿...");
      const answer = await fetchFromGoogle(text);
      renderMessage('bot', answer);
      // Save bot's answer in memory too
      memory.conversationHistory.push(answer);
    } else {
      renderMessage('bot', "à¦¦à§à¦ƒà¦–à¦¿à¦¤, à¦†à¦®à¦¿ à¦à¦–à¦¨à§‹ à¦ªà§à¦°à§‹à¦ªà§à¦°à¦¿ à¦¬à§à¦à¦¤à§‡ à¦ªà¦¾à¦°à¦›à¦¿ à¦¨à¦¾à¥¤");
    }
  }

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendMessage();
  });

</script>

</body>
</html>
